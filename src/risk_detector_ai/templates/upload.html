{% extends 'base.html' %}

{% block title %}Upload{% endblock %}

{% block content %}
  <div class="row">
    <div class="col-md-8 mx-auto">
      <h2 class="mb-4">Enviar Arquivo CSV para Análise de Risco</h2>
      
      <div class="card bg-dark border-secondary">
        <div class="card-body">
          <form id="uploadForm" method="post" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="fileInput" class="form-label">Selecione o arquivo CSV:</label>
              <div class="drop-zone border-2 border-dashed p-5 text-center rounded" id="dropzone" style="cursor: pointer; transition: all 0.3s;">
                <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #3ddc84;"></i>
                <p class="mt-3 mb-2">Arraste o arquivo aqui ou clique para selecionar</p>
                <small class="text-muted">Aceita arquivos .csv com colunas: user_id, stake_amount, odds, created_at</small>
                <input type="file" name="file" accept=".csv" id="fileInput" class="form-control d-none" />
              </div>
            </div>
            
            <div class="d-grid gap-2">
              <button class="btn btn-primary btn-lg" type="submit">
                <i class="fas fa-upload"></i> Processar Arquivo
              </button>
            </div>
          </form>

          {% with messages = get_flashed_messages() %}
            {% if messages %}
              {% for message in messages %}
                <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}
        </div>
      </div>

      <div class="mt-4 p-3 bg-dark border border-secondary rounded">
        <h5 class="text-success">Requisitos do CSV:</h5>
        <ul class="small text-muted">
          <li><strong>user_id</strong>: Identificador único do jogador (obrigatório)</li>
          <li><strong>stake_amount</strong>: Valor da aposta</li>
          <li><strong>odds</strong>: Odds da aposta</li>
          <li><strong>created_at</strong>: Data da aposta</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const uploadForm = document.getElementById('uploadForm');

    // Drag and drop
    dropzone.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropzone.style.backgroundColor = 'rgba(61, 220, 132, 0.1)';
      dropzone.style.borderColor = '#3ddc84';
    });

    dropzone.addEventListener('dragleave', () => {
      dropzone.style.backgroundColor = '';
      dropzone.style.borderColor = '';
    });

    dropzone.addEventListener('drop', (e) => {
      e.preventDefault();
      dropzone.style.backgroundColor = '';
      dropzone.style.borderColor = '';
      const files = e.dataTransfer.files;
      if (files.length) {
        fileInput.files = files;
        uploadForm.submit();
      }
    });

    // Click to select
    dropzone.addEventListener('click', () => {
      fileInput.click();
    });

    fileInput.addEventListener('change', () => {
      if (fileInput.files.length) {
        uploadForm.submit();
      }
    });
  </script>
{% endblock %}
